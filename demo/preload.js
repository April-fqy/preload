var Preload=function(e){"use strict";var t,r,n=e.sources||null,a=e.connector||null,o=e.progress||function(){},u=e.completeLoad||function(){},i=0,l=0,c=0,s=0,f=[],h=[],g=[],d=["jpg","png","gif"],t={xhr:null,timeOut:e.loadingOverTime||15,timeOutCB:e.loadingOverTimeCB||function(){},id:0,max:3},p=document.getElementsByTagName("head")[0],m=[],v=[],x=[],b=[],X=function(){S(),null!=a&&O(),M(f[0],h[0],g)},y=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject){if("string"!=typeof arguments.callee.activeXString){var e,t,r=["MSXML2.XMLHttp.6.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp"];for(e=0,t=r.length;t>e;e++)try{new ActiveXObject(r[e]),arguments.callee.activeXString=r[e];break}catch(n){}}return new ActiveXObject(arguments.callee.activeXString)}throw new Error("No XHR object available.")}(),S=function(){if(null!==n){r=Object.getOwnPropertyNames(n).length;for(var e in n){for(var t=0,a=n[e].source.length;a>t;t++)f.push(n[e].source[t]);g.push(n[e].source.length),h.push("undefined"==typeof n[e].callback?null:n[e].callback)}for(var e=1,a=g.length;a>e;e++)g[e]=g[e-1]+g[e];l=f.length,m=document.getElementsByTagName("img");for(var e=0,a=m.length;a>e;e++)m[e].attributes.pSrc&&(v[e]=m[e].attributes.pSrc.value);x=document.getElementsByTagName("audio");for(var e=0,a=x.length;a>e;e++)x[e].attributes.pSrc&&(b[e]=x[e].attributes.pSrc.value)}},M=function(e,n,a){if(c>=a[s]&&(null!=h[s]&&h[s](),++s),s>=r)return void u();if(T(e)){var g=new Image,d=setTimeout(function(){t.timeOutCB()},1e3*t.timeOut);g.src=e,g.onload=function(){clearTimeout(d),o(++i,l);for(var t=0,r=v.length;r>t;t++)if(v[t]==e){m[t].src=v[t];break}M(f[++c],n,a)},g.onerror=function(){o(++i,l),M(f[++c],n,a)}}else t.xhr=y,t.xhr.onreadystatechange=function(){if(4==t.xhr.readyState){if(t.xhr.status>=200&&t.xhr.status<300||304===t.xhr.status){o(++i,l);for(var r=0,u=b.length;u>r;r++)if(b[r]==e){x[r].src=b[r];break}M(f[++c],n,a)}}else t.xhr.status>=400&&t.xhr.status<500&&(o(++i,l),M(f[++c],n,a))},t.xhr.open("GET",e,!0),t.xhr.send(null)},O=function(){for(var e in a)a[e].jsonp?L(a[e].url):w(a[e].url,a[e].callback)},T=function(e){for(var t=e.split(".").pop(),r=0,n=d.length;n>r;r++)if(t==d[r])return!0;return!1},w=function(e,r){t.xhr=y,t.xhr.onreadystatechange=function(){4==t.xhr.readyState&&(t.xhr.status>=200&&t.xhr.status<300||304===t.xhr.status)&&r(t.xhr.responseText)},t.xhr.open("GET",e,!0),t.xhr.send(null)},L=function(e){var t=document.createElement("script");t.src=e,p.appendChild(t)};X()};"object"==typeof module?module.exports=Preload:window.Preload=Preload;