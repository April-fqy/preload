"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==_typeof2(Symbol.iterator)?function(t){return void 0===t?"undefined":_typeof2(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":_typeof2(t)};!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(void 0).imageLoad=e()}(0,function(){return function(){function t(e){_classCallCheck(this,t),e=e||{},this.callBack={},this.progress=e.progress?e.progress.bind(this):function(){},this.timeOut=e.timeOut||15,this.timeOutCB=e.timeOutCB?e.timeOutCB.bind(this):function(){},this.reset(),this.imgNode=[],this.loadTag()}return _createClass(t,[{key:"load",value:function(t){var e=this,o=this;return new Promise(function(n,r){e.isArrayFn(t)||r(new Error("It's not allow params")),t.length||r(new Error("It's not null")),o.reset(t.length),o.imgList=t,t.forEach(function(t){var r=new Image,i=o._timeOut(t);r.src=t,r.onload=o.onload.bind(e,t,i,n),r.onerror=o.onerror.bind(e,t,i,n)})})}},{key:"loadTag",value:function(){for(var t=this,e=document.getElementsByTagName("img"),o=0,n=e.length;o<n;o++)!function(o,n){if(e[o].attributes["p-src"]){var r=new Image,i=e[o].attributes["p-src"].value,s=t._timeOut(i);r.src=i,r.onload=function(){clearTimeout(s),e[o].src=i}}}(o)}},{key:"_timeOut",value:function(t){var e=this,o=setTimeout(function(){e.timeOutCB({name:t,msg:"load timer"}),clearTimeout(o)},1e3*e.timeOut);return o}},{key:"onload",value:function(t,e,o){clearTimeout(e),this.success.data.push(t),this.progress(++this.flag,this.count),this.complate(o)}},{key:"onerror",value:function(t,e,o){clearTimeout(e),this.err.data.push(t),this.progress(++this.flag,this.count),this.complate(o)}},{key:"complate",value:function(t){this.flag>=this.count&&t(this.success)}},{key:"reset",value:function(t){this.imgList=[],this.flag=0,this.count=t,this.success={code:0,msg:"success",data:[]},this.err={code:-1,msg:"load error",data:[]}}},{key:"isArrayFn",value:function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)}}]),t}()});