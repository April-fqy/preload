"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),ImageLoad=function(){function e(t){_classCallCheck(this,e),t=t||{},this.callBack={},this.progress=t.progress?t.progress.bind(this):function(){},this.timeOut=t.timeOut||15,this.timeOutCB=t.timeOutCB?t.timeOutCB.bind(this):function(){},this.reset(),this.imgNode=[],this.loadTag()}return _createClass(e,[{key:"load",value:function(e){var t=this,n=this;return new Promise(function(r,o){t.isArrayFn(e)||o(new Error("It's not allow params")),e.length||o(new Error("It's not null")),n.reset(e.length),n.imgList=e,e.forEach(function(e){var o=new Image,i=n._timeOut(e);o.src=e,o.onload=n.onload.bind(t,e,i,r),o.onerror=n.onerror.bind(t,e,i,r)})})}},{key:"loadTag",value:function(){for(var e=this,t=document.getElementsByTagName("img"),n=0,r=t.length;n<r;n++)!function(n,r){if(t[n].attributes["p-src"]){var o=new Image,i=t[n].attributes["p-src"].value,s=e._timeOut(i);o.src=i,o.onload=function(){clearTimeout(s),t[n].src=i}}}(n)}},{key:"_timeOut",value:function(e){var t=this,n=setTimeout(function(){t.timeOutCB({name:e,msg:"load timer"}),clearTimeout(n)},1e3*t.timeOut);return n}},{key:"onload",value:function(e,t,n){clearTimeout(t),this.success.data.push(e),this.progress(++this.flag,this.count),this.complate(n)}},{key:"onerror",value:function(e,t,n){clearTimeout(t),this.err.data.push(e),this.progress(++this.flag,this.count),this.complate(n)}},{key:"complate",value:function(e){this.flag>=this.count&&e(this.success)}},{key:"reset",value:function(e){this.imgList=[],this.flag=0,this.count=e,this.success={code:0,msg:"success",data:[]},this.err={code:-1,msg:"load error",data:[]}}},{key:"isArrayFn",value:function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}}]),e}(),cssLoad=function(e,t,n){function r(e){return i.body?e():setTimeout(function(){r(e)})}var o=function e(t){for(var n=a.href,r=s.length;r--;)if(s[r].href===n)return t();setTimeout(function(){e(t)})},i=window.document,s=i.styleSheets,a=i.createElement("link"),n=n||"all";if(a.rel="stylesheet",a.href=e,a.media=n,!t){var u=(i.getElementsByTagName("head")[0]||i.body).childNodes;t=u[u.length-1]}r(function(){t.parentNode.insertBefore(a,t||t.nextSibling)}),a.addEventListener&&a.addEventListener("load",function(e){if(navigator.userAgent.toLowerCase().match(/firefox/)){var n=i.createElement("script");t.parentNode.insertBefore(n,t||t.nextSibling)}}),a.onloadcssdefined=o,o(function(){a.media!==n&&(a.media=n)})},fontLoad=function(e,t,n,r){var o=document.createElement("link");if(o.rel="preload",o.href=e,o.as=t||"font",o.type=n||"font/ttf",o.setAttribute("crossorigin","anonymous"),r=r||function(){},!o.relList||!o.relList.supports||!o.relList.supports("preload"))return alert("unsupports: Resource Hints preload"),0;o.addEventListener("load",function(){r()}),document.getElementsByTagName("head")[0].appendChild(o)};exports.imageLoad=ImageLoad,exports.cssLoad=cssLoad,exports.fontLoad=fontLoad;