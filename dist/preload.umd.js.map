{"version":3,"file":"preload.umd.js","sources":["../src/preload.js"],"sourcesContent":["class Preload{\r\n\tconstructor(opts){\r\n\t\topts = opts || {};\r\n\t\tthis.callBack = {};\r\n\t\tthis.progress = opts.progress ? opts.progress.bind(this) : function(){};\r\n\t\tthis.timeOut = opts.timeOut || 15;\r\n\t\tthis.timeOutCB = opts.timeOutCB ? opts.timeOutCB.bind(this) : function(){};\r\n\r\n\r\n\t\t// 初始化队列加载参数\r\n\t\tthis.reset();\t\r\n\r\n\t\t//获取img标签预加载资源列表\r\n\t\tthis.imgNode = [];\r\n\t\tthis.loadTag();\r\n\t}\r\n\r\n\r\n\tload(imgList){\r\n\t\tconst that = this;\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tif(!this.isArrayFn(imgList)) reject(new Error(\"It's not allow params\"));\r\n\t\t\tif(!imgList.length) reject(new Error(\"It's not null\"));\r\n\t\t\t//重置队列\r\n\t\t\tthat.reset(imgList.length);\r\n\r\n\t\t\tthat.imgList = imgList;\r\n\r\n\t\t\timgList.forEach((item) => {\r\n\t\t\t\t//开始加载\r\n\t\t\t\tlet img = new Image();\r\n\t\t\t\t//超时回调\r\n\t\t\t\tlet timer = that._timeOut(item);\r\n\t\t\t\t// console.log('that.timer=',that.timer);\r\n\r\n\t\t\t\timg.src = item;\r\n\r\n\t\t\t\t//加载成功\r\n\t\t\t\timg.onload = that.onload.bind(this, item, timer, resolve);\r\n\t\t\t\t//加载失败\r\n\t\t\t\timg.onerror = that.onerror.bind(this, item, timer, resolve);\r\n\r\n\t\t\t})\r\n\r\n\t\t})\r\n\t}\r\n\r\n\tloadTag(){\r\n\t\tconst that = this;\r\n\t\tlet imgNode = document.getElementsByTagName('img');\r\n\t\tfor(let i = 0, len = imgNode.length; i < len; i++){\r\n            if(imgNode[i].attributes['p-src']){\r\n\t\t\t\t//开始加载\r\n\t\t\t\tlet img = new Image();\r\n\t\t\t\tlet src = imgNode[i].attributes['p-src'].value;\r\n\t\t\t\t//超时回调\r\n\t\t\t\tlet timer = that._timeOut(src);\r\n\t\t\t\t\r\n\t\t\t\timg.src = src;\r\n\t\t\t\timg.onload = ()=>{\r\n\t\t\t\t\tclearTimeout(timer);\r\n\t\t\t\t\timgNode[i].src = src;\r\n\t\t\t\t}\r\n            }\r\n        }\r\n\r\n\t}\r\n\r\n    _timeOut(src) {\r\n    \tconst that = this;\r\n\r\n        let timer = setTimeout(() => {\r\n            that.timeOutCB({\r\n                name: src,\r\n                msg: \"load timer\"\r\n            });\r\n            clearTimeout(timer);\r\n        }, that.timeOut * 1000);\r\n        return timer;\r\n    \tconsole.log('timer=', timer);\r\n    }\r\n\r\n\r\n    onload(src, timer, resolve) {\r\n        //清理计时器\r\n        clearTimeout(timer);\r\n        //加载成功信息记录\r\n        this.success.data.push(src);\r\n        //执行进度回调\r\n        this.progress(++this.flag, this.count);\r\n        //队列加载完成后调起then\r\n        this.complate(resolve);\r\n    }\r\n\r\n    onerror(src, timer, resolve) {\r\n        //清理计时器\r\n        clearTimeout(timer);\r\n        //错误信息记录\r\n        this.err.data.push(src);\r\n        //执行进度回调\r\n        this.progress(++this.flag, this.count);\r\n\r\n        //队列加载完成后调起then\r\n        this.complate(resolve);\r\n    }\t\r\n\r\n    complate(resolve){\r\n        if(this.flag >= this.count){\r\n        \tresolve(this.success);\r\n        }\r\n\r\n    }\r\n\r\n\treset(len){\r\n\t\tthis.imgList = [];\r\n\t\tthis.flag = 0;\r\n\t\tthis.count = len;\r\n\t\tthis.success = {\t\t\t\t\t\t\r\n\t\t\tcode: 0,\r\n\t\t\tmsg: 'success',\r\n\t\t\tdata: []\r\n\t\t};\t\r\n\t\tthis.err = {\t\t\t\t\t\r\n\t\t\tcode: -1,\r\n\t\t\tmsg: 'load error',\r\n\t\t\tdata: []\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tisArrayFn(arr){\r\n\t\tif(typeof Array.isArray == \"function\") return Array.isArray(arr);\r\n\r\n\t\treturn Object.prototype.toString.call(arr) === '[object Array]';\r\n\t}\r\n\r\n}\r\n\r\nexport default Preload;"],"names":["this","let","i","len"],"mappings":";;;;;;AAAA,IAAM,OAAO,GAAA,gBACD,CAAC,IAAI,CAAC;CACjB,IAAK,GAAG,IAAI,IAAI,EAAE,CAAC;CACnB,IAAK,CAAC,QAAQ,GAAG,EAAE,CAAC;CACpB,IAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,UAAU,EAAE,CAAC;CACzE,IAAK,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,IAAI,EAAE,CAAC;CACnC,IAAK,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,UAAU,EAAE,CAAC;;;;CAI5E,IAAK,CAAC,KAAK,EAAE,CAAC;;;CAGd,IAAK,CAAC,OAAO,GAAG,EAAE,CAAC;CACnB,IAAK,CAAC,OAAO,EAAE,CAAC;CACf,CAAA;;;AAGF,kBAAC,IAAI,kBAAC,OAAO,CAAC;;;CACb,IAAO,IAAI,GAAG,IAAI,CAAC;;CAEnB,OAAQ,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAE;EACrC,GAAI,CAACA,MAAI,CAAC,SAAS,CAAC,OAAO,CAAC,EAAE,EAAA,MAAM,CAAC,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC,CAAC,EAAA;EACzE,GAAI,CAAC,OAAO,CAAC,MAAM,EAAE,EAAA,MAAM,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,EAAA;;EAExD,IAAK,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;;EAE5B,IAAK,CAAC,OAAO,GAAG,OAAO,CAAC;;EAExB,OAAQ,CAAC,OAAO,CAAC,UAAC,IAAI,EAAE;;GAEvB,IAAK,GAAG,GAAG,IAAI,KAAK,EAAE,CAAC;;GAEvB,IAAK,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;;;GAGjC,GAAI,CAAC,GAAG,GAAG,IAAI,CAAC;;;GAGhB,GAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAACA,MAAI,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC;;GAE3D,GAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAACA,MAAI,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC;;GAE5D,CAAC,CAAA;;EAEF,CAAC;CACF,CAAA;;AAEF,kBAAC,OAAO,sBAAE;CACT,IAAO,IAAI,GAAG,IAAI,CAAC;CACnB,IAAK,OAAO,GAAG,QAAQ,CAAC,oBAAoB,CAAC,KAAK,CAAC,CAAC;CACpD,+BAAmD;YACxC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;;GAE3C,IAAK,GAAG,GAAG,IAAI,KAAK,EAAE,CAAC;GACvB,IAAK,GAAG,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC;;GAEhD,IAAK,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;;GAEhC,GAAI,CAAC,GAAG,GAAG,GAAG,CAAC;GACf,GAAI,CAAC,MAAM,GAAG,WAAE;IACf,YAAa,CAAC,KAAK,CAAC,CAAC;IACrB,OAAQ,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,GAAG,CAAC;IACrB,CAAA;aACQ;SACJ;;EAdP,IAAIC,IAAIC,CAAC,GAAG,CAAC,EAAEC,GAAG,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,CAc1C,eAAA;;CAEP,CAAA;;IAEE,kBAAA,QAAQ,sBAAC,GAAG,EAAE;IACd,IAAO,IAAI,GAAG,IAAI,CAAC;;QAEfF,IAAI,KAAK,GAAG,UAAU,CAAC,YAAG;YACtB,IAAI,CAAC,SAAS,CAAC;gBACX,IAAI,EAAE,GAAG;gBACT,GAAG,EAAE,YAAY;aACpB,CAAC,CAAC;YACH,YAAY,CAAC,KAAK,CAAC,CAAC;SACvB,EAAE,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC;QACxB,OAAO,KAAK,CAAC;IACjB,OAAQ,CAAC,GAAG,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;KAC7B,CAAA;;;IAGD,kBAAA,MAAM,oBAAC,GAAG,EAAE,KAAK,EAAE,OAAO,EAAE;;QAExB,YAAY,CAAC,KAAK,CAAC,CAAC;;QAEpB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;QAE5B,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;;QAEvC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;KAC1B,CAAA;;IAED,kBAAA,OAAO,qBAAC,GAAG,EAAE,KAAK,EAAE,OAAO,EAAE;;QAEzB,YAAY,CAAC,KAAK,CAAC,CAAC;;QAEpB,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;;QAExB,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;;;QAGvC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;KAC1B,CAAA;;IAED,kBAAA,QAAQ,sBAAC,OAAO,CAAC;QACb,GAAG,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,KAAK,CAAC;QAC3B,OAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACtB;;KAEJ,CAAA;;AAEL,kBAAC,KAAK,mBAAC,GAAG,CAAC;CACV,IAAK,CAAC,OAAO,GAAG,EAAE,CAAC;CACnB,IAAK,CAAC,IAAI,GAAG,CAAC,CAAC;CACf,IAAK,CAAC,KAAK,GAAG,GAAG,CAAC;CAClB,IAAK,CAAC,OAAO,GAAG;EACf,IAAK,EAAE,CAAC;EACR,GAAI,EAAE,SAAS;EACf,IAAK,EAAE,EAAE;EACR,CAAC;CACH,IAAK,CAAC,GAAG,GAAG;EACX,IAAK,EAAE,CAAC,CAAC;EACT,GAAI,EAAE,YAAY;EAClB,IAAK,EAAE,EAAE;;EAER,CAAA;CACD,CAAA;;AAEF,kBAAC,SAAS,uBAAC,GAAG,CAAC;CACd,GAAI,OAAO,KAAK,CAAC,OAAO,IAAI,UAAU,EAAE,EAAA,OAAO,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,EAAA;;CAElE,OAAQ,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,gBAAgB,CAAC;CAChE,CAAA,AAIF;;;;"}